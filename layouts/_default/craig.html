{{ define "main" }}

{{ $img := resources.Get "images/big-craig.png" }}
{{ $img = $img.Resize "500x webp q90" }}

{{ $userAvatar := resources.Get "images/user-avatar.png" }}
{{ $userAvatar = $userAvatar.Resize "100x webp q90" }}

{{ $bigCraig := $img.Resize "100x webp q90" }}

{{ $responses := index .Site.Data "big-craig" }}

  <div class='hx:mx-auto hx:flex hextra-max-page-width'>
    {{ partial "sidebar.html" (dict "context" . "disableSidebar" true "displayPlaceholder" true) }}
    {{ partial "toc.html" . }}
    <article class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx:w-full hx:min-w-0 hx:max-w-6xl hx:px-6 hx:pt-4 hx:md:px-12">
        {{ partial "breadcrumb.html" (dict "page" . "enable" false) }}
        <br class="hx:mt-1.5 hx:text-sm" />
        {{ if .Title }}<h1 class="hx:text-center hx:mt-2 hx:text-4xl hx:font-bold hx:tracking-tight hx:text-slate-900 hx:dark:text-slate-100">{{ .Title }}</h1>{{ end }}
        <div class="hx:mb-16"></div>
        <div class="content">
          {{ .Content }}
        </div>
        <div class="hx:mt-16"></div>
        {{ partial "components/comments.html" . }}
      </main>
    </article>
  </div>

  <script>

const chatBox = document.getElementById("chat-box"),
  userInput = document.getElementById("user-input");

const responses = [

  {{ range $responses.responses }}
    "{{ . }}",
  {{ end }}

];

userInput.addEventListener("keydown", function (e) {
  if (e.key === "Enter") {
      const inputText = userInput.value.trim();
      if (inputText !== "") {
          appendMessage("user", inputText);
          respondToUser();
          userInput.value = "";
      }
  }
});

function appendMessage(role, text) {
const messageElement = document.createElement('div');
messageElement.style = `display: flex; align-items: flex-end; ${role === 'user' ? 'justify-content: flex-start' : 'justify-content: flex-end'}`;

const avatarElement = document.createElement('img');
avatarElement.src = role === 'user' ? '{{ $userAvatar.RelPermalink }}' : '{{ $bigCraig.RelPermalink }}';
avatarElement.alt = 'Avatar';
avatarElement.style = `${role === 'user' ? 'order:-999;height:50px;width:auto' : 'order:999;height:50px;width:auto' }; border-radius: 1em; margin: 0 .5em;`;


const messageContent = document.createElement('p');
messageContent.style = `${role === "user" ? "background:white !important; margin-right:auto;" : "margin-left:auto; background:black; color: white !important;"} width:fit-content; max-width:60%; margin-bottom: 0.5rem; border-radius: 0.25rem; padding: 0.5rem 1rem; font-size: 0.875rem; line-height: 1.25rem; color: rgb(0 0 0);`;
messageContent.textContent = text;

messageElement.appendChild(avatarElement);
messageElement.appendChild(messageContent);

chatBox.appendChild(messageElement);
chatBox.scrollTop = chatBox.scrollHeight;
}


function respondToUser() {
  const randomIndex = Math.floor(Math.random() * responses.length);
  const response = responses[randomIndex];
  setTimeout(() => {
      appendMessage("bot", response);
  }, 700);
}

</script>

{{ end }}
